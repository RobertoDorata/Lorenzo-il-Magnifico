<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CLI.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">LM34</a> &gt; <a href="index.source.html" class="el_package">it.polimi.ingsw.LM34.UI.CLI</a> &gt; <span class="el_source">CLI.java</span></div><h1>CLI.java</h1><pre class="source lang-java linenums">package it.polimi.ingsw.LM34.UI.CLI;

import it.polimi.ingsw.LM34.Enums.Controller.LeaderCardsAction;
import it.polimi.ingsw.LM34.Enums.Controller.PlayerSelectableContexts;
import it.polimi.ingsw.LM34.Enums.Model.DevelopmentCardColor;
import it.polimi.ingsw.LM34.Enums.Model.PawnColor;
import it.polimi.ingsw.LM34.Enums.Model.ResourceType;
import it.polimi.ingsw.LM34.Enums.Model.WorkingAreaType;
import it.polimi.ingsw.LM34.Enums.UI.GameInformationType;
import it.polimi.ingsw.LM34.Enums.UI.NetworkType;
import it.polimi.ingsw.LM34.Exceptions.Validation.IncorrectInputException;
import it.polimi.ingsw.LM34.Model.Boards.GameBoard.*;
import it.polimi.ingsw.LM34.Model.Boards.PlayerBoard.BonusTile;
import it.polimi.ingsw.LM34.Model.Cards.AbstractDevelopmentCard;
import it.polimi.ingsw.LM34.Model.Cards.ExcommunicationCard;
import it.polimi.ingsw.LM34.Model.Cards.LeaderCard;
import it.polimi.ingsw.LM34.Model.Dice;
import it.polimi.ingsw.LM34.Model.Effects.ResourceRelatedBonus.ResourcesBonus;
import it.polimi.ingsw.LM34.Model.FamilyMember;
import it.polimi.ingsw.LM34.Model.Player;
import it.polimi.ingsw.LM34.Model.Resources;
import it.polimi.ingsw.LM34.Network.Client.AbstractClient;
import it.polimi.ingsw.LM34.Network.Client.ClientNetworkController;
import it.polimi.ingsw.LM34.Network.RMI.RMIClient;
import it.polimi.ingsw.LM34.Network.Socket.SocketClient;
import it.polimi.ingsw.LM34.Network.PlayerAction;
import it.polimi.ingsw.LM34.UI.UIInterface;
import it.polimi.ingsw.LM34.Utils.Utilities;
import it.polimi.ingsw.LM34.Utils.Validator;
import org.apache.commons.lang3.tuple.ImmutablePair;
import org.apache.commons.lang3.tuple.Pair;

import java.util.*;
import java.util.logging.Level;

import static it.polimi.ingsw.LM34.Enums.Controller.PlayerSelectableContexts.*;
import static it.polimi.ingsw.LM34.Enums.Model.DevelopmentCardColor.MULTICOLOR;
import static it.polimi.ingsw.LM34.UI.CLI.CLIStuff.*;
import static it.polimi.ingsw.LM34.UI.UIConnectionInfo.*;
import static it.polimi.ingsw.LM34.Utils.Utilities.LOGGER;

/**
 * this class implements in console mode all method specified by {@link UIInterface}
 */
public class CLI implements UIInterface {
    private AbstractClient networkClient;
    private ClientNetworkController networkController;

    private List&lt;Tower&gt; towers;
    private WorkingArea productionArea;
    private WorkingArea harvestArea;
    private Market market;
    private CouncilPalace palace;
    private Map&lt;Integer, Integer&gt; faithPath;
    private Map&lt;Integer, Integer&gt; mapMilitaryPointsForTerritories;
    private Map&lt;Integer, Integer&gt; mapCharactersToVictoryPoints;
    private Map&lt;Integer, Integer&gt; mapTerritoriesToVictoryPoints;
    private List&lt;ExcommunicationCard&gt; excommunicationCards;
    private List&lt;Player&gt; players;
    private List&lt;Dice&gt; dices;
    private List&lt;PlayerSelectableContexts&gt; selectableContexts;

<span class="nc" id="L63">    public CLI() {</span>
<span class="nc" id="L64">        dices = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L65">        players= new ArrayList&lt;&gt;();</span>
<span class="nc" id="L66">        excommunicationCards = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L67">        towers = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L68">        selectableContexts = Arrays.asList(PlayerSelectableContexts.values());</span>
<span class="nc" id="L69">    }</span>
    private Integer selectionMenu(List&lt;?&gt; data, Optional&lt;String&gt; backString, Optional&lt;String&gt; message, Optional&lt;String&gt; errorMessage) {
<span class="nc" id="L71">        backString.ifPresent(str -&gt; printFormat(&quot;%1$d) %2$s%n&quot;, 0, str));</span>
<span class="nc bnc" id="L72" title="All 2 branches missed.">        for (int i = 0; i &lt; data.size(); i++)</span>
<span class="nc" id="L73">            printFormat(&quot;%1$d) %2$s%n&quot;, i + 1, data.get(i).toString());</span>

<span class="nc" id="L75">        message.ifPresent(CLIStuff::printLine);</span>
        Integer selectedValue;
        try {
<span class="nc" id="L78">            selectedValue = Integer.parseInt(readUserInput.nextLine()) - 1;</span>
<span class="nc bnc" id="L79" title="All 4 branches missed.">            if(selectedValue &gt;= 0 || !backString.isPresent())</span>
<span class="nc" id="L80">                Validator.checkValidity(selectedValue, data);</span>
        }
<span class="nc" id="L82">        catch (IncorrectInputException | NumberFormatException ex) {</span>
<span class="nc" id="L83">            LOGGER.log(Level.FINEST, ex.getMessage(), ex);</span>
<span class="nc" id="L84">            errorMessage.ifPresent(CLIStuff::printError);</span>
<span class="nc" id="L85">            selectedValue = selectionMenu(data, backString, message, errorMessage);</span>
<span class="nc" id="L86">        }</span>

<span class="nc" id="L88">        return selectedValue;</span>
    }

    /**
     * Let the player choose the connection type and the try to login
     */
    @Override
    public void show() {
<span class="nc" id="L96">        NetworkType connectionTypeChoice = connectionTypeSelection();</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">        if(connectionTypeChoice == NetworkType.RMI) {</span>
<span class="nc" id="L98">            this.networkClient = new RMIClient(SERVER_IP, RMI_PORT, this);</span>
        }
<span class="nc bnc" id="L100" title="All 2 branches missed.">        else if (connectionTypeChoice == NetworkType.SOCKET) {</span>
<span class="nc" id="L101">            this.networkClient = new SocketClient(SERVER_IP, SOCKET_PORT, this);</span>
        }

<span class="nc" id="L104">        this.networkController = networkClient.getNetworkController();</span>
<span class="nc" id="L105">        loginMenu();</span>
<span class="nc" id="L106">    }</span>

    /**
     * this method will be called when the console will ask to user to insert his username and password
     */
    @Override
    public void loginMenu() {
<span class="nc" id="L113">        printLine(&quot;--- Login ---&quot;);</span>

<span class="nc" id="L115">        printLine(&quot;Username:&quot;);</span>
<span class="nc" id="L116">        String playerUsername = readUserInput.nextLine();</span>

<span class="nc" id="L118">        printLine(&quot;Password:&quot;);</span>
<span class="nc" id="L119">        String playerPassword = readUserInput.nextLine();</span>

<span class="nc" id="L121">        networkController.login(playerUsername, playerPassword);</span>
<span class="nc" id="L122">    }</span>

    /**
     * Receives the login operation result
     * @param result login result
     */
    @Override
    public void loginResult(Boolean result) {
<span class="nc bnc" id="L130" title="All 2 branches missed.">        if (result)</span>
<span class="nc" id="L131">            printLine(&quot;Access granted!&quot;);</span>
        else {
<span class="nc" id="L133">            printError(&quot;Access denied! Wrong username or password&quot;);</span>
<span class="nc" id="L134">            loginMenu();</span>
        }
<span class="nc" id="L136">    }</span>

    @Override
    public void loadExcommunicationCards(List&lt;ExcommunicationCard&gt; excommunicationCards) {
<span class="nc" id="L140">        this.excommunicationCards = excommunicationCards;</span>
<span class="nc" id="L141">    }</span>

    @Override
    public void updateTowers(List&lt;Tower&gt; towers) {
<span class="nc" id="L145">        this.towers = towers;</span>
<span class="nc" id="L146">    }</span>
    @Override
    public void updateCouncilPalace(CouncilPalace councilPalace) {
<span class="nc" id="L149">        this.palace = councilPalace;</span>
<span class="nc" id="L150">    }</span>
    @Override
    public void updateMarket(Market market) {
<span class="nc" id="L153">        this.market = market;</span>
<span class="nc" id="L154">    }</span>
    @Override
    public void updateProductionArea(WorkingArea productionArea) {
<span class="nc" id="L157">        this.productionArea = productionArea;</span>
<span class="nc" id="L158">    }</span>
    @Override
    public void updateHarvestArea(WorkingArea harvestArea) {
<span class="nc" id="L161">        this.harvestArea = harvestArea;</span>
<span class="nc" id="L162">    }</span>
    @Override
    public void updatePlayersData(List&lt;Player&gt; players) {
<span class="nc" id="L165">        this.players = players;</span>
<span class="nc" id="L166">    }</span>
    @Override
    public void updateDiceValues(List&lt;Dice&gt; dicesValues) {
<span class="nc" id="L169">        this.dices = dicesValues;</span>
<span class="nc" id="L170">    }</span>

    /**
     * Let the player choose a leader between the
     * @param activatedLeadersByOtherPlayers that other players have activated during the game
     * @return the selected index of the leader to copy
     */
    @Override
    public Integer leaderCardCopy(List&lt;LeaderCard&gt; activatedLeadersByOtherPlayers) {
<span class="nc" id="L179">       return leaderCardSelectionPhase(activatedLeadersByOtherPlayers);</span>
    }

    /**
     * Show the game results and declare the winner
     * @param players in game
     */
    @Override
    public void endGame(List&lt;Player&gt; players) {
<span class="nc" id="L188">        Integer maxVictoryPointsScored = 0;</span>
        Integer playerPoints;
<span class="nc" id="L190">        String winnerName = &quot;&quot;;</span>

        /*Shows the points scored by all players*/
<span class="nc" id="L193">        players.forEach(player -&gt; {</span>
<span class="nc" id="L194">                    printPlayerName(player.getPlayerName(), player.getPawnColor());</span>
<span class="nc" id="L195">                    printFormat(&quot; has scored %1$s victory points%n&quot;, player.getResources().getResourceByType(ResourceType.VICTORY_POINTS));</span>
<span class="nc" id="L196">                }</span>
        );

        /*And now declare the winner*/
<span class="nc bnc" id="L200" title="All 2 branches missed.">        for(Player player : players) {</span>
<span class="nc" id="L201">            playerPoints = player.getResources().getResourceByType(ResourceType.VICTORY_POINTS);</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">            if (playerPoints &gt; maxVictoryPointsScored) {</span>
<span class="nc" id="L203">                maxVictoryPointsScored = playerPoints;</span>
<span class="nc" id="L204">                winnerName = player.getPlayerName();</span>
            }
<span class="nc" id="L206">        }</span>
<span class="nc" id="L207">        printFormat(&quot;And... THE WINNER IS %1$s%n&quot;, winnerName);</span>
<span class="nc" id="L208">    }</span>

    @Override
    public PlayerAction turnMainAction(Optional&lt;Exception&gt; lastActionValid) {
<span class="nc bnc" id="L212" title="All 2 branches missed.">        if (!lastActionValid.isPresent())</span>
<span class="nc" id="L213">            showPlayersInfo();</span>
        else
<span class="nc" id="L215">            printError(lastActionValid.get().getMessage());</span>

<span class="nc" id="L217">        Optional&lt;PlayerSelectableContexts&gt; context = contextSelection(this.selectableContexts);</span>
<span class="nc bnc" id="L218" title="All 2 branches missed.">        if(!context.isPresent())</span>
<span class="nc" id="L219">            return new PlayerAction(null, null);</span>

<span class="nc bnc" id="L221" title="All 7 branches missed.">        switch (context.get()) {</span>
            case TOWERS_CONTEXT:
<span class="nc" id="L223">                return new PlayerAction(TOWERS_CONTEXT, towerSlotSelection());</span>
            case COUNCIL_PALACE_CONTEXT:
<span class="nc" id="L225">                councilPalaceSelection();</span>
<span class="nc" id="L226">                return new PlayerAction(COUNCIL_PALACE_CONTEXT, null);</span>
            case HARVEST_AREA_CONTEXT:
<span class="nc" id="L228">                return new PlayerAction(HARVEST_AREA_CONTEXT, workingAreaSlotSelection(WorkingAreaType.HARVEST));</span>
            case PRODUCTION_AREA_CONTEXT:
<span class="nc" id="L230">                return new PlayerAction(PRODUCTION_AREA_CONTEXT, workingAreaSlotSelection(WorkingAreaType.PRODUCTION));</span>
            case MARKET_AREA_CONTEXT:
<span class="nc" id="L232">                return new PlayerAction(MARKET_AREA_CONTEXT, marketSlotSelection());</span>
            case LEADER_CARDS_CONTEXT:
<span class="nc" id="L234">                return new PlayerAction(LEADER_CARDS_CONTEXT, null);</span>
            default:
<span class="nc" id="L236">                return turnMainAction(Optional.of(new IncorrectInputException()));</span>
        }
    }

    @Override
    public PlayerAction turnSecondaryAction(Optional&lt;Exception&gt; lastActionValid) {
<span class="nc" id="L242">        lastActionValid.ifPresent(ex -&gt; printError(ex.getMessage()));</span>

<span class="nc" id="L244">        List&lt;PlayerSelectableContexts&gt; contexts = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L245">        contexts.add(LEADER_CARDS_CONTEXT);</span>

<span class="nc" id="L247">        Optional&lt;PlayerSelectableContexts&gt; context = contextSelection(contexts);</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">        if(!context.isPresent())</span>
<span class="nc" id="L249">            return new PlayerAction(null, null);</span>

<span class="nc bnc" id="L251" title="All 2 branches missed.">        switch (context.get()) {</span>
            case LEADER_CARDS_CONTEXT:
<span class="nc" id="L253">                return new PlayerAction(LEADER_CARDS_CONTEXT, null);</span>
            default:
<span class="nc" id="L255">                return turnSecondaryAction(Optional.of(new IncorrectInputException()));</span>
        }
    }

    @Override
    public PlayerAction freeAction(PlayerAction action, Optional&lt;Exception&gt; lastActionValid) {

<span class="nc" id="L262">        lastActionValid.ifPresent(ex -&gt; printError(ex.getMessage()));</span>

<span class="nc" id="L264">        List&lt;PlayerSelectableContexts&gt; contexts = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L265">        contexts.add(action.getContext());</span>

<span class="nc" id="L267">        Optional&lt;PlayerSelectableContexts&gt; context = contextSelection(contexts);</span>
<span class="nc bnc" id="L268" title="All 2 branches missed.">        if(!context.isPresent())</span>
<span class="nc" id="L269">            return new PlayerAction(null, null);</span>

<span class="nc bnc" id="L271" title="All 4 branches missed.">        switch (context.get()) {</span>
            case TOWERS_CONTEXT:
<span class="nc" id="L273">                return new PlayerAction(TOWERS_CONTEXT, towerSlotSelection());</span>
            case HARVEST_AREA_CONTEXT:
<span class="nc" id="L275">                return new PlayerAction(HARVEST_AREA_CONTEXT, workingAreaSlotSelection(WorkingAreaType.HARVEST));</span>
            case PRODUCTION_AREA_CONTEXT:
<span class="nc" id="L277">                return new PlayerAction(PRODUCTION_AREA_CONTEXT, workingAreaSlotSelection(WorkingAreaType.PRODUCTION));</span>
            default:
<span class="nc" id="L279">                return turnSecondaryAction(Optional.of(new IncorrectInputException()));</span>
        }
    }

    /**
     * @param familyMembers available to the player
     * @return familyMember choosed from the player
     */
    @Override
    public Integer familyMemberSelection(List&lt;FamilyMember&gt; familyMembers) {
<span class="nc" id="L289">        List&lt;String&gt; familyMembersString = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L290">        familyMembers.forEach(fm -&gt; familyMembersString.add(String.format(&quot;%1$s (Value: %2$d)&quot;, fm.getDiceColorAssociated(), fm.getValue())));</span>
<span class="nc" id="L291">        return selectionMenu(familyMembersString,</span>
<span class="nc" id="L292">                Optional.empty(),</span>
<span class="nc" id="L293">                Optional.of(&quot;Select the family member to use&quot;),</span>
<span class="nc" id="L294">                Optional.of(&quot;Select a valid family member&quot;));</span>
    }

    /**
     * this method will be called when the console will ask user what kind of connection technology he wants to use, Rmi or Socket
     * @return the user's choice
     */
    private NetworkType connectionTypeSelection() {
<span class="nc" id="L302">        List&lt;NetworkType&gt; networkTypes = Arrays.asList(NetworkType.values());</span>
<span class="nc" id="L303">        Integer selection = selectionMenu(networkTypes,</span>
<span class="nc" id="L304">                Optional.empty(),</span>
<span class="nc" id="L305">                Optional.of(&quot;Select the network connection type&quot;),</span>
<span class="nc" id="L306">                Optional.of(INVALID_SELECTION));</span>

<span class="nc" id="L308">        return networkTypes.get(selection);</span>
    }

    /**
     * this method will be called when the user will have to select the
     * {@link it.polimi.ingsw.LM34.Controller.AbstractGameContext} to enter
     */
    private Optional&lt;PlayerSelectableContexts&gt; contextSelection(List&lt;PlayerSelectableContexts&gt; allContext)  {
<span class="nc" id="L316">        Integer selection = selectionMenu(allContext,</span>
<span class="nc" id="L317">                Optional.of(&quot;End turn&quot;),</span>
<span class="nc" id="L318">                Optional.of(&quot;Select the context to enter or 0 to end this turn&quot;),</span>
<span class="nc" id="L319">                Optional.of(INVALID_SELECTION));</span>

<span class="nc bnc" id="L321" title="All 2 branches missed.">        if(selection &lt; 0)</span>
<span class="nc" id="L322">            return Optional.empty();</span>

<span class="nc" id="L324">        return Optional.of(allContext.get(selection));</span>
    }

    /**
     * This method will be called when player will want to enter into the {@link Market}
     */
    private Integer marketSlotSelection() {
        /*Show the market*/
<span class="nc" id="L332">        printSlots(market.getActionSlots());</span>
<span class="nc" id="L333">        printLine(&quot;In which slot do you want to place one of your pawn?\n&quot;);</span>

<span class="nc" id="L335">        return checkInput(market.getActionSlots());</span>
    }

    /**
     * Provides the player the ability to select one of the two {@link WorkingAreaType} to enter
     */
    private Integer workingAreaSlotSelection(WorkingAreaType workingArea) {
        Integer selectedSlot;

<span class="nc" id="L344">        showProductionArea();</span>
<span class="nc" id="L345">        showHarvestArea();</span>

<span class="nc" id="L347">       CLIStuff.printFormat(&quot;In which slot of the %1$s area do you want to enter?%n&quot;, workingArea.toString());</span>

<span class="nc bnc" id="L349" title="All 2 branches missed.">       if(workingArea.getWorkingAreaType().equalsIgnoreCase(productionArea.toString()))</span>
<span class="nc" id="L350">           selectedSlot = checkInput(productionArea.getActionSlots());</span>
       else
<span class="nc" id="L352">           selectedSlot = checkInput(harvestArea.getActionSlots());</span>

<span class="nc" id="L354">        return selectedSlot;</span>
    }

    /**
     * this method will be called when player will enter into Council Palace
     */
    private void councilPalaceSelection() {
        /*SHOW COUNCIL PALACE*/
<span class="nc" id="L362">        printCouncilPalace();</span>

<span class="nc" id="L364">        printLine(&quot;You selected to place one of your pawns in the Council Palace. Enter something to continue&quot;);</span>
<span class="nc" id="L365">        readUserInput.next();</span>
<span class="nc" id="L366">    }</span>

    /**
     * Shows the CouncilPalace state
     */
    private void printCouncilPalace() {
<span class="nc" id="L372">        ActionSlot actionSlot = palace.getActionSlot();</span>
<span class="nc" id="L373">        List&lt;FamilyMember&gt; occupyingPawns = palace.getActionSlot().getFamilyMembers();</span>

<span class="nc" id="L375">        printFormat(&quot;Council Palace resources: %1$s CouncilPrivileges: %2$s%n&quot;, actionSlot.getResourcesReward().getResources().getResources(),</span>
<span class="nc" id="L376">                                        actionSlot.getResourcesReward().getCouncilPrivilege());</span>

<span class="nc" id="L378">        occupyingPawns.forEach(p -&gt; printPawn(p.getFamilyMemberColor(), p.getDiceColorAssociated()));</span>
<span class="nc" id="L379">        printLine(&quot;&quot;);</span>
<span class="nc" id="L380">    }</span>

    /**
     * Provides a graphic knowledge of the rewards each slots of a particular {@link GameSpace}
     * @param slots
     */
    private void printSlots(List&lt;ActionSlot&gt; slots) {
<span class="nc" id="L387">        List&lt;List&lt;Pair&lt;String, Integer&gt;&gt;&gt; slotsResources = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L388">        List&lt;FamilyMember&gt; pawnsInserted = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L389">        List&lt;Integer&gt; diceValues = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L391">        slots.forEach((ActionSlot as) -&gt; {</span>
<span class="nc" id="L392">            diceValues.add(as.getDiceValue());</span>
            /*PAWN COLOR INSERTED IN SLOT*/
<span class="nc bnc" id="L394" title="All 2 branches missed.">            if(!as.getFamilyMembers().isEmpty())</span>
<span class="nc" id="L395">                pawnsInserted.add(as.getFamilyMembers().get(0));</span>
            else
<span class="nc" id="L397">                pawnsInserted.add(null);</span>
<span class="nc" id="L398">            List&lt;Pair&lt;String, Integer&gt;&gt; res = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L399">            Resources resources = as.getResourcesReward().getResources();</span>
<span class="nc" id="L400">            resources.getResources().forEach((ResourceType rt, Integer val) -&gt; res.add(new ImmutablePair&lt;&gt;(rt.toString(), val)));</span>
<span class="nc bnc" id="L401" title="All 2 branches missed.">            if (as.getResourcesReward().getCouncilPrivilege() &gt; 0)</span>
<span class="nc" id="L402">                res.add(new ImmutablePair&lt;&gt;(&quot;COUNCIL PRIVILEGES&quot;, as.getResourcesReward().getCouncilPrivilege()));</span>
<span class="nc" id="L403">            slotsResources.add(res);</span>
<span class="nc" id="L404">        });</span>

<span class="nc" id="L406">        Integer resourcesLines = 0;</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">        for (List sr : slotsResources) {</span>
<span class="nc bnc" id="L408" title="All 2 branches missed.">            if (sr.size() &gt; resourcesLines)</span>
<span class="nc" id="L409">                resourcesLines = sr.size();</span>
<span class="nc" id="L410">        }</span>

<span class="nc" id="L412">        diceValues.forEach(diceValue -&gt; printDiceValue(diceValue.toString()));</span>
<span class="nc" id="L413">        printLine(&quot;&quot;);</span>

<span class="nc" id="L415">        pawnsInserted.forEach(pawn -&gt; {</span>
<span class="nc bnc" id="L416" title="All 2 branches missed.">            if(pawn != null)</span>
<span class="nc" id="L417">                printPawn(pawn.getFamilyMemberColor(), pawn.getDiceColorAssociated());</span>
            else
<span class="nc" id="L419">                printFormat(&quot;            &quot;);</span>
<span class="nc" id="L420">        });</span>

<span class="nc" id="L422">        printFormat(&quot;%n %1$s %n&quot;, String.join(&quot; &quot;, Collections.nCopies(slotsResources.size(), &quot;__________&quot;)));</span>
<span class="nc" id="L423">        printFormat(&quot;|%1$s|%n&quot;, String.join(&quot;|&quot;, Collections.nCopies(slotsResources.size(), &quot;          &quot;)));</span>

<span class="nc bnc" id="L425" title="All 2 branches missed.">        for (int i = 0; i &lt; resourcesLines; i++) {</span>
            String s;

            /*print resource value and get resources' splitted string*/
<span class="nc" id="L429">            s = &quot;|&quot;;</span>
<span class="nc" id="L430">            List&lt;String[]&gt; splittedStrings = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L431">            Integer resourceNameLines = 0;</span>
<span class="nc bnc" id="L432" title="All 2 branches missed.">            for (List&lt;Pair&lt;String,Integer&gt;&gt; sr : slotsResources) {</span>
<span class="nc bnc" id="L433" title="All 2 branches missed.">                if (i &lt; sr.size()) {</span>
<span class="nc" id="L434">                    s = String.format(&quot;%1$s%2$-10s|&quot;, s, sr.get(i).getValue());</span>
<span class="nc" id="L435">                    String[] splittedResourceName = Utilities.splitStringByLength(sr.get(i).getKey(), 10);</span>
<span class="nc" id="L436">                    splittedStrings.add(splittedResourceName);</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">                    if (splittedResourceName.length &gt; resourceNameLines)</span>
<span class="nc" id="L438">                        resourceNameLines = splittedResourceName.length;</span>
<span class="nc" id="L439">                }</span>
                else {
<span class="nc" id="L441">                    s = String.format(&quot;%1$s%2$10s|&quot;, s, &quot;&quot;);</span>
<span class="nc" id="L442">                    splittedStrings.add(new String[0]);</span>
                }
<span class="nc" id="L444">            }</span>
<span class="nc" id="L445">            printLine(s);</span>

            /*print resources names*/
<span class="nc bnc" id="L448" title="All 2 branches missed.">            for (int j = 0; j &lt; resourceNameLines; j++) {</span>
<span class="nc" id="L449">                s = &quot;|&quot;;</span>
<span class="nc bnc" id="L450" title="All 2 branches missed.">                for (String[] name : splittedStrings) {</span>
<span class="nc bnc" id="L451" title="All 2 branches missed.">                    if (j &lt; name.length)</span>
<span class="nc" id="L452">                        s = String.format(&quot;%1$s%2$-10s|&quot;, s, name[j]);</span>
                    else
<span class="nc" id="L454">                        s = String.format(&quot;%1$s%2$10s|&quot;, s, &quot;&quot;);</span>
<span class="nc" id="L455">                }</span>
<span class="nc" id="L456">                printLine(s);</span>
            }

            /*print empty line*/
<span class="nc" id="L460">            printFormat(&quot;|%1$s|%n&quot;, String.join(&quot;|&quot;, Collections.nCopies(slotsResources.size(), &quot;          &quot;)));</span>
        }

<span class="nc" id="L463">        printFormat(&quot;|%1$s|%n%n&quot;, String.join(&quot;|&quot;, Collections.nCopies(slotsResources.size(), &quot;__________&quot;)));</span>
<span class="nc" id="L464">    }</span>

    /**
     * this method will be called when the user will have to choose in which tower wants to make his action and in which tower's floor
     */
    private Pair&lt;DevelopmentCardColor, Integer&gt; towerSlotSelection() {
        DevelopmentCardColor towerType;
        Integer floor;

        /*SHOW THE TOWERS*/
<span class="nc" id="L474">        printTowers();</span>

        /*Let the player choose the tower based on DevelopmentCardColor*/
<span class="nc" id="L477">        List&lt;String&gt; colors = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L478" title="All 2 branches missed.">        for(DevelopmentCardColor color : DevelopmentCardColor.values())</span>
<span class="nc bnc" id="L479" title="All 2 branches missed.">            if(color != MULTICOLOR)</span>
<span class="nc" id="L480">                colors.add(color.name());</span>
<span class="nc" id="L481">        towerType = DevelopmentCardColor.valueOf(</span>
<span class="nc" id="L482">                colors.get(selectionMenu(colors,</span>
<span class="nc" id="L483">                        Optional.empty(),</span>
<span class="nc" id="L484">                        Optional.of(&quot;In which tower do you wish to bring your family member?&quot;),</span>
<span class="nc" id="L485">                        Optional.of(INVALID_SELECTION))));</span>

        /*Let the player choose the level of the selected tower*/
<span class="nc" id="L488">        printLine(&quot;In which tower's floor do you want to place your pawn?\n&quot;);</span>
<span class="nc" id="L489">        floor = readUserInput.nextInt();</span>

<span class="nc" id="L491">        return new ImmutablePair&lt;&gt;(towerType, --floor);</span>
    }

    /**
     * this method will be called when user need to use some servants to improve his pawn's value
     * @param servantsAvailable user's available servants
     * @param minimumServantsRequested minimum number of servants to complete action
     * @return how many servants user has decided to use
     */
    @Override
    public Integer servantsSelection(Integer servantsAvailable, Integer minimumServantsRequested) {
<span class="nc" id="L502">        Boolean validUserInput = false;</span>
<span class="nc" id="L503">        Integer input = 0;</span>

<span class="nc bnc" id="L505" title="All 2 branches missed.">        if(minimumServantsRequested &gt; 0)</span>
<span class="nc" id="L506">            printFormat(&quot;To complete this action, you need at least %1$d servants (you have %2$d servants)%n&quot;, minimumServantsRequested, servantsAvailable);</span>
        else
<span class="nc" id="L508">            printFormat(&quot;You can use servants to increment your family member's value (%1$s available)%n&quot;, servantsAvailable);</span>
<span class="nc" id="L509">        printLine(&quot;How many servants do you wish to use?&quot;);</span>

        do {
            try {
<span class="nc" id="L513">                input = Integer.parseInt(readUserInput.nextLine());</span>
<span class="nc" id="L514">                Validator.checkValidity(input, minimumServantsRequested, servantsAvailable);</span>
<span class="nc" id="L515">                validUserInput = true;</span>
            }
<span class="nc" id="L517">            catch (IncorrectInputException | NumberFormatException e) {</span>
<span class="nc" id="L518">                LOGGER.log(Level.FINEST, e.getMessage(), e);</span>
<span class="nc" id="L519">                printError(INCORRECT_INPUT);</span>
<span class="nc" id="L520">            }</span>
<span class="nc bnc" id="L521" title="All 2 branches missed.">        } while(!validUserInput);</span>

<span class="nc" id="L523">        return input;</span>
    }

    /**
     * @param choices available about resource exchange bonuses
     * @return the reward opted by the player
     */
    @Override
    public Integer resourceExchangeSelection(List&lt;Pair&lt;Resources, ResourcesBonus&gt;&gt; choices) {
<span class="nc" id="L532">        List&lt;String&gt; choicesList = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L533">        choices.forEach(c -&gt; choicesList.add(String.format(&quot;Resources required: %1$s ---&gt; Resources provided: %2$s, CouncilPrivileges provided: %3$d&quot;,</span>
<span class="nc" id="L534">                c.getLeft().getResources().toString(), c.getRight().getResources().getResources().toString(), c.getRight().getCouncilPrivilege())));</span>

<span class="nc" id="L536">        return selectionMenu(choicesList,</span>
<span class="nc" id="L537">                Optional.of(&quot;Ignore bonus&quot;),</span>
<span class="nc" id="L538">                Optional.of(&quot;Select the resource exchange to apply&quot;),</span>
<span class="nc" id="L539">                Optional.of(INVALID_SELECTION));</span>
    }


    /**
     * @param leadersOwned that the game consider the player to have available
     * @return the leader choosed and the action to perform on him
     */
    @Override
    public Pair&lt;String, LeaderCardsAction&gt; leaderCardSelection(List&lt;LeaderCard&gt; leadersOwned) {
<span class="nc bnc" id="L549" title="All 2 branches missed.">        if(leadersOwned.isEmpty()) {</span>
<span class="nc" id="L550">            printError(&quot;No leaders to choose from!&quot;);</span>
<span class="nc" id="L551">            return null;</span>
        }

<span class="nc" id="L554">        List&lt;String&gt; items = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L555">        items.add(LeaderCardsAction.PLAY.name());</span>
<span class="nc" id="L556">        items.add(LeaderCardsAction.DISCARD.name());</span>

<span class="nc" id="L558">        LeaderCardsAction selectedAction = LeaderCardsAction.valueOf(</span>
<span class="nc" id="L559">                items.get(selectionMenu(items,</span>
<span class="nc" id="L560">                        Optional.empty(),</span>
<span class="nc" id="L561">                        Optional.of(&quot;Choose a leader card action&quot;),</span>
<span class="nc" id="L562">                        Optional.of(INVALID_SELECTION))));</span>

<span class="nc" id="L564">        items = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L565" title="All 2 branches missed.">        for(LeaderCard card : leadersOwned)</span>
<span class="nc" id="L566">            items.add(card.getName());</span>

<span class="nc" id="L568">        String selectedLeader = items.get(selectionMenu(items,</span>
<span class="nc" id="L569">                Optional.empty(),</span>
<span class="nc" id="L570">                Optional.of(&quot;Choose the leader to apply the action to&quot;),</span>
<span class="nc" id="L571">                Optional.of(INVALID_SELECTION)));</span>

<span class="nc" id="L573">        return new ImmutablePair&lt;&gt;(selectedLeader, selectedAction);</span>
    }

    /**
     * The Curch Report decision asked from the game to the player
     * @return the decision of the player
     */
    @Override
    public Boolean churchSupport() {
        String input;
<span class="nc" id="L583">        printFormat(&quot;Do you want to Support the Church (yes/no)?%n&quot;);</span>

<span class="nc" id="L585">        input = readUserInput.nextLine();</span>

<span class="nc bnc" id="L587" title="All 2 branches missed.">        if(&quot;yes&quot;.equalsIgnoreCase(input))</span>
<span class="nc" id="L588">            return true;</span>
<span class="nc bnc" id="L589" title="All 2 branches missed.">        else if (&quot;no&quot;.equalsIgnoreCase(input))</span>
<span class="nc" id="L590">            return false;</span>
        else {
<span class="nc" id="L592">            printError(INCORRECT_INPUT);</span>
<span class="nc" id="L593">            return churchSupport();</span>
        }
    }

    /**
     * This class is called for the {@link it.polimi.ingsw.LM34.Model.Cards.AbstractDevelopmentCard}
     * that have as an alternative requirement option the payment of MILITARY_POINTS
     */
    @Override
    public Boolean alternativeRequirementsPayment() {
        String input;
<span class="nc" id="L604">        printFormat(&quot;Do you want to pay military points for this card (yes/no)?%n&quot;);</span>

<span class="nc" id="L606">        input = readUserInput.nextLine();</span>

<span class="nc bnc" id="L608" title="All 2 branches missed.">        if(&quot;yes&quot;.equalsIgnoreCase(input))</span>
<span class="nc" id="L609">            return true;</span>
<span class="nc bnc" id="L610" title="All 2 branches missed.">        else if(&quot;no&quot;.equalsIgnoreCase(input))</span>
<span class="nc" id="L611">            return false;</span>
        else {
<span class="nc" id="L613">            printError(INCORRECT_INPUT);</span>
<span class="nc" id="L614">            return alternativeRequirementsPayment();</span>
        }
    }

    /**
     * @param availableBonuses, set from the game
     * @return the choice made by the player among the options in input
     */
    @Override
    public Integer selectCouncilPrivilegeBonus(List&lt;Resources&gt; availableBonuses) {
<span class="nc" id="L624">        List&lt;String&gt; councilPrivileges = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L625">        availableBonuses.forEach(bonus -&gt; councilPrivileges.add(bonus.getResources().toString()));</span>

<span class="nc" id="L627">        return selectionMenu(councilPrivileges,</span>
<span class="nc" id="L628">                Optional.empty(),</span>
<span class="nc" id="L629">                Optional.of(&quot;Choose the reward you desire&quot;),</span>
<span class="nc" id="L630">                Optional.of(INVALID_SELECTION));</span>
    }

    /**
     *Prints all the {@link Tower} and their {@link TowerSlot}s showing informations about cards stored
     * and the reward each slots provides
     */
    public void printTowers() {

<span class="nc bnc" id="L639" title="All 2 branches missed.">        for(Tower tower : this.towers) {</span>
<span class="nc" id="L640">            List&lt;List&lt;Pair&lt;String,Integer&gt;&gt;&gt; slotsResources = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L641">            List&lt;Integer&gt; diceValues = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L642">            List&lt;FamilyMember&gt; pawnsInserted = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L643">            List&lt;String&gt; cardNames = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L644">            tower.getTowerSlots().forEach((TowerSlot as) -&gt; {</span>
<span class="nc" id="L645">                List&lt;Pair&lt;String,Integer&gt;&gt; res = new ArrayList&lt;&gt;();</span>
                /*DICE VALUE*/
<span class="nc" id="L647">                diceValues.add(as.getDiceValue());</span>
                /*PAWN COLOR INSERTED IN SLOT*/
<span class="nc bnc" id="L649" title="All 2 branches missed.">                if(!as.getFamilyMembers().isEmpty())</span>
<span class="nc" id="L650">                    pawnsInserted.add(as.getFamilyMembers().get(0));</span>
                else
<span class="nc" id="L652">                    pawnsInserted.add(null);</span>
<span class="nc bnc" id="L653" title="All 2 branches missed.">                if(as.getCardStored() != null)</span>
<span class="nc" id="L654">                    cardNames.add(as.getCardStored().getName());</span>
                else
<span class="nc" id="L656">                    cardNames.add(&quot;&quot;);</span>

<span class="nc" id="L658">                Resources resources = as.getResourcesReward().getResources();</span>
<span class="nc" id="L659">                resources.getResources().forEach((ResourceType rt, Integer val) -&gt; res.add(new ImmutablePair&lt;&gt;(rt.toString(), val)));</span>
<span class="nc bnc" id="L660" title="All 2 branches missed.">                if (as.getResourcesReward().getCouncilPrivilege() &gt; 0)</span>
<span class="nc" id="L661">                    res.add(new ImmutablePair&lt;&gt;(&quot;COUNCIL PRIVILEGES&quot;, as.getResourcesReward().getCouncilPrivilege()));</span>
<span class="nc" id="L662">                slotsResources.add(res);</span>
<span class="nc" id="L663">            });</span>

<span class="nc" id="L665">            Integer resourcesLines = 0;</span>
<span class="nc bnc" id="L666" title="All 2 branches missed.">            for (List sr : slotsResources) {</span>
<span class="nc bnc" id="L667" title="All 2 branches missed.">                if (sr.size() &gt; resourcesLines)</span>
<span class="nc" id="L668">                    resourcesLines = sr.size();</span>
<span class="nc" id="L669">            }</span>

<span class="nc" id="L671">            printTowerTypeColor(tower.getCardColor());</span>

<span class="nc" id="L673">            printLine(&quot;&quot;);</span>
<span class="nc" id="L674">            diceValues.forEach(dv -&gt; printDiceValue(dv.toString()));</span>
<span class="nc" id="L675">            printLine(&quot;&quot;);</span>

<span class="nc" id="L677">            pawnsInserted.forEach(pawn -&gt; {</span>
<span class="nc bnc" id="L678" title="All 2 branches missed.">                if(pawn != null)</span>
<span class="nc" id="L679">                    printPawn(pawn.getFamilyMemberColor(), pawn.getDiceColorAssociated());</span>
                else
<span class="nc" id="L681">                    printFormat(&quot;           &quot;);</span>
<span class="nc" id="L682">            });</span>

<span class="nc" id="L684">            printLine(&quot;&quot;);</span>
<span class="nc" id="L685">            printFormat(&quot;\&quot;Remaining cards in the tower (in order): \&quot;&quot;);</span>
<span class="nc" id="L686">            cardNames.forEach(c -&gt; {</span>
<span class="nc bnc" id="L687" title="All 2 branches missed.">                if(&quot;&quot;.equalsIgnoreCase(c))</span>
<span class="nc" id="L688">                    printFormat(&quot; ************,&quot;);</span>
                else
<span class="nc" id="L690">                    printFormat(&quot; %1$s, &quot;, c);</span>
<span class="nc" id="L691">            });</span>

<span class="nc" id="L693">            printFormat(&quot;%n %1$s %n&quot;, String.join(&quot; &quot;, Collections.nCopies(slotsResources.size(), &quot;__________&quot;)));</span>
<span class="nc" id="L694">            printFormat(&quot;|%1$s|%n&quot;, String.join(&quot;|&quot;, Collections.nCopies(slotsResources.size(), &quot;          &quot;)));</span>
<span class="nc bnc" id="L695" title="All 2 branches missed.">            for (int i = 0; i &lt; resourcesLines; i++) {</span>
                String s;

            /*print resource value and get resources' splitted string*/
<span class="nc" id="L699">                s = &quot;|&quot;;</span>
<span class="nc" id="L700">                List&lt;String[]&gt; splittedStrings = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L701">                Integer resourceNameLines = 0;</span>
<span class="nc bnc" id="L702" title="All 2 branches missed.">                for (List&lt;Pair&lt;String,Integer&gt;&gt; sr : slotsResources) {</span>
<span class="nc bnc" id="L703" title="All 2 branches missed.">                    if (i &lt; sr.size()) {</span>
<span class="nc" id="L704">                        s = String.format(&quot;%1$s%2$-10s|&quot;, s, sr.get(i).getValue());</span>
<span class="nc" id="L705">                        String[] splittedResourceName = Utilities.splitStringByLength(sr.get(i).getKey(), 10);</span>
<span class="nc" id="L706">                        splittedStrings.add(splittedResourceName);</span>
<span class="nc bnc" id="L707" title="All 2 branches missed.">                        if (splittedResourceName.length &gt; resourceNameLines)</span>
<span class="nc" id="L708">                            resourceNameLines = splittedResourceName.length;</span>
<span class="nc" id="L709">                    }</span>
                    else {
<span class="nc" id="L711">                        s = String.format(&quot;%1$s%2$10s|&quot;, s, &quot;&quot;);</span>
<span class="nc" id="L712">                        splittedStrings.add(new String[0]);</span>
                    }
<span class="nc" id="L714">                }</span>
<span class="nc" id="L715">                printLine(s);</span>

            /*print resources names*/
<span class="nc bnc" id="L718" title="All 2 branches missed.">                for (int j = 0; j &lt; resourceNameLines; j++) {</span>
<span class="nc" id="L719">                    s = &quot;|&quot;;</span>
<span class="nc bnc" id="L720" title="All 2 branches missed.">                    for (String[] name : splittedStrings) {</span>
<span class="nc bnc" id="L721" title="All 2 branches missed.">                        if (j &lt; name.length)</span>
<span class="nc" id="L722">                            s = String.format(&quot;%1$s%2$-10s|&quot;, s, name[j]);</span>
                        else
<span class="nc" id="L724">                            s = String.format(&quot;%1$s%2$10s|&quot;, s, &quot;&quot;);</span>
<span class="nc" id="L725">                    }</span>
<span class="nc" id="L726">                    printLine(s);</span>
                }

            /*print empty line*/
<span class="nc" id="L730">                printFormat(&quot;|%1$s|%n&quot;, String.join(&quot;|&quot;, Collections.nCopies(slotsResources.size(), &quot;          &quot;)));</span>
            }

<span class="nc" id="L733">            printFormat(&quot;|%1$s|%n&quot;, String.join(&quot;|&quot;, Collections.nCopies(slotsResources.size(), &quot;__________&quot;)));</span>
<span class="nc" id="L734">          }</span>
<span class="nc" id="L735">    }</span>

    /**
     * Shows the {@link ExcommunicationCard}s that have been choosed at game startup
     */
    private void showExcommunicationCards() {
<span class="nc" id="L741">        excommunicationCards.forEach(ex -&gt; printFormat(&quot;Period %1$d, Penalty %2$s%n&quot;, ex.getPeriod(),ex.getPenalty().getClass().getSimpleName()));</span>
<span class="nc" id="L742">    }</span>

    /**
     * Shows all infos about each players in the game
     */
    private void showPlayersInfo() {
<span class="nc" id="L748">        CLIStuff.printToConsole.println(&quot;Here are the information about the players in the game&quot;);</span>
<span class="nc" id="L749">        players.forEach(p -&gt; {</span>

            /*Leader the player has activated*/
<span class="nc" id="L752">            printPlayer(p.getPawnColor(),p.getPlayerName());</span>
<span class="nc bnc" id="L753" title="All 4 branches missed.">            if(p.getActivatedLeaderCards() != null &amp;&amp; p.getActivatedLeaderCards().isEmpty()) {</span>
<span class="nc" id="L754">                printLine(&quot;Activated leaders: &quot;);</span>
<span class="nc" id="L755">                p.getActivatedLeaderCards().forEach(c -&gt; printFormat(&quot;%1$s &quot;, c.getName()));</span>
            }

            /*Resources the player has*/
<span class="nc" id="L759">            printLine(&quot;\nResources:&quot;);</span>
<span class="nc" id="L760">            Resources res = p.getResources();</span>
<span class="nc bnc" id="L761" title="All 2 branches missed.">            for(ResourceType t : ResourceType.values())</span>
<span class="nc" id="L762">                printFormat(&quot;%1$s: %2$s%n&quot;, t.toString(), res.getResourceByType(t).toString());</span>

            /*The ExcommunicationCards of the player*/
<span class="nc" id="L765">            printLine(&quot;\nPenalties:&quot;);</span>
<span class="nc" id="L766">            p.getExcommunicationCards().forEach(e -&gt; printFormat(&quot;%1$s: %2$s%n&quot;, e.getPeriod(),</span>
<span class="nc" id="L767">                                                e.getPenalty().getClass().getSimpleName()));</span>

            /*The AbstractDevelopmentCards the players has bought during the game*/
<span class="nc" id="L770">            printFormat(&quot;Personal Board of player %1$s%n&quot;, p.getPlayerName());</span>
<span class="nc bnc" id="L771" title="All 2 branches missed.">            for(DevelopmentCardColor color : DevelopmentCardColor.values()) {</span>
<span class="nc" id="L772">                Optional&lt;List&lt;AbstractDevelopmentCard&gt;&gt; cards = p.getPersonalBoard().getDevelopmentCardsByType(color);</span>
<span class="nc" id="L773">                cards.ifPresent(cardsList -&gt; {</span>
<span class="nc" id="L774">                    printTowerTypeColor(color);</span>
<span class="nc" id="L775">                    cardsList.forEach(card -&gt; printFormat(&quot;%1$s &quot;, card.getName()));</span>
<span class="nc" id="L776">                    printLine(&quot;&quot;);</span>
<span class="nc" id="L777">                });</span>
            }
<span class="nc" id="L779">        });</span>
<span class="nc" id="L780">    }</span>

    /**
     * Shows the values of the 3 {@link Dice}s in this round
     */
    private void showDiceValues() {
<span class="nc" id="L786">        dices.forEach(d -&gt; printFormat(&quot;%1$s value: %2$d &quot;, d.getColor().toString(), d.getValue()));</span>
<span class="nc" id="L787">    }</span>

    /**
     *Inform the player that his turn has ended (for timeout or his choice)
     */
    @Override
    public void endTurn() {
<span class="nc" id="L794">        printYellow(&quot;Your turn has ended\n&quot;);</span>
<span class="nc" id="L795">    }</span>

    /**
     * Inform the player that the server is no more reachable
     */
    @Override
    public void disconnectionWarning() {
<span class="nc" id="L802">        printError(&quot;You are not connected to the game\n&quot;);</span>
<span class="nc" id="L803">    }</span>

    /**
     * Shows multiple kind of info about players
     * @param infoType information about a player {@link GameInformationType}
     * @param playerName the associated player
     * @param playerColor the color associated to the player to whom the info concerns
     */
    @Override
    public void informInGamePlayers(GameInformationType infoType, String playerName, PawnColor playerColor) {
<span class="nc" id="L813">        printPlayerName(playerName + &quot;&quot; + infoType.toString() +&quot;\n&quot;, playerColor);</span>
<span class="nc" id="L814">    }</span>

    /**
     * @param bonusTiles that the players has the opportunity to choose one from
     * @return the bonus tile the player wants to have during the game
     */
    @Override
    public Integer bonusTileSelection(List&lt;BonusTile&gt; bonusTiles) {
<span class="nc" id="L822">        List&lt;String&gt; bonusTilesString = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L823">        bonusTiles.forEach(bt -&gt;</span>
<span class="nc" id="L824">            bonusTilesString.add(String.format(&quot;Harvest: %1$s Production: %2$s&quot;,</span>
<span class="nc" id="L825">                    bt.getHarvestBonus().getResources().getResources().toString(),</span>
<span class="nc" id="L826">                    bt.getProductionBonus().getResources().getResources().toString()))</span>
        );

<span class="nc" id="L829">        return selectionMenu(bonusTilesString,</span>
<span class="nc" id="L830">                Optional.empty(),</span>
<span class="nc" id="L831">                Optional.of(&quot;Choose the bonus tile you desire to have&quot;),</span>
<span class="nc" id="L832">                Optional.of(INVALID_SELECTION));</span>
    }

    /**
     * @param leaderCards that the players has the opportunity to choose one from
     * @return the leader the player wants to have as one of his 4 leaders
     */
    @Override
    public Integer leaderCardSelectionPhase(List&lt;LeaderCard&gt; leaderCards) {
<span class="nc" id="L841">        List&lt;String&gt; leaderCardsString = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L842">        leaderCards.forEach(lc -&gt; leaderCardsString.add(lc.getName()));</span>

<span class="nc" id="L844">        return selectionMenu(leaderCardsString,</span>
<span class="nc" id="L845">                Optional.empty(),</span>
<span class="nc" id="L846">                Optional.of(&quot;Choose the leader you desire to have at your service&quot;),</span>
<span class="nc" id="L847">                Optional.of(&quot;Invalid selection&quot;));</span>
    }

    /**
     * Store the info from the server about this game object
     */
    @Override
    public void loadMapTerritoriesToVictoryPoints(Map&lt;Integer, Integer&gt; mapTerritoriesToVictoryPoints) {
<span class="nc" id="L855">        this.mapTerritoriesToVictoryPoints = mapTerritoriesToVictoryPoints;</span>
<span class="nc" id="L856">    }</span>

    @Override
    public void loadMapMilitaryPointsForTerritories(Map&lt;Integer, Integer&gt; mapMilitaryPointsForTerritories) {
<span class="nc" id="L860">        this.mapMilitaryPointsForTerritories = mapMilitaryPointsForTerritories;</span>

<span class="nc" id="L862">    }</span>

    /**
     * Store the info from the server about this game object
     */
    @Override
    public void loadMapCharactersToVictoryPoints(Map&lt;Integer, Integer&gt; mapCharactersToVictoryPoints) {
<span class="nc" id="L869">        this.mapCharactersToVictoryPoints = mapCharactersToVictoryPoints;</span>
<span class="nc" id="L870">    }</span>

    /**
     * Store the info from the server about this game object
     */
    @Override
    public void loadFaithPath(Map&lt;Integer, Integer&gt; faithPath) {
<span class="nc" id="L877">        this.faithPath = faithPath;</span>
<span class="nc" id="L878">    }</span>

    /**
     * Presents to the player the association between # of cards and victory points
     */
    public void showMapCharactersToVictoryPoints() {
<span class="nc" id="L884">        printToConsole.println(&quot;Here is the mapping between number of characters owned and victory points provided at endGame&quot;);</span>
<span class="nc" id="L885">        mapTerritoriesToVictoryPoints.forEach((pos, points) -&gt; printFormat(&quot;%1$d: %2$d%n&quot;, pos, points));</span>
<span class="nc" id="L886">    }</span>

    /**
     * Presents to the player the association between # of cards and victory points
     */
    public void showMapTerritoriesToVictoryPoints() {
<span class="nc" id="L892">        printToConsole.println(&quot;Here is the mapping between number of territories owned and victory points provided at endGame&quot;);</span>
<span class="nc" id="L893">        mapCharactersToVictoryPoints.forEach((pos, points) -&gt; printFormat(&quot;%1$d: %2$d%n&quot;, pos, points));</span>
<span class="nc" id="L894">    }</span>

    /**
     * Presents to the player the state of the FaithPath
     */
    public void showFaithPath() {
<span class="nc" id="L900">        printToConsole.println(&quot;Here is the mapping between the position on the faithPath and victory points provided at Church Support&quot;);</span>
<span class="nc" id="L901">        faithPath.forEach((pos, points) -&gt; printFormat(&quot;%1$d: %2$d%n&quot;, pos, points));</span>
<span class="nc" id="L902">    }</span>

    /**
     * Presents to the player the # of military points needed for territories cards
     */
    public void showMilitaryPointsForTerritories() {
<span class="nc" id="L908">        printToConsole.println(&quot;Here is the mapping between the number of territories and the military points required to get another territory card&quot;);</span>
<span class="nc" id="L909">        mapMilitaryPointsForTerritories.forEach((pos, points) -&gt; printFormat(&quot;%1$d: %2$d%n&quot;, pos, points));</span>
<span class="nc" id="L910">    }</span>

    @Override
    public void startGame() {
<span class="nc" id="L914">        printLine(&quot;The game has started!\n&quot;);</span>
<span class="nc" id="L915">    }</span>

    /**
     * Presents to the player the state of the ProductionArea
     */
    private void showProductionArea() {
<span class="nc" id="L921">        printYellow(&quot;Production Area single slot:&quot;);</span>
<span class="nc" id="L922">        List&lt;ActionSlot&gt; tempSlots = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L923">        tempSlots.add(productionArea.getSingleSlot());</span>
<span class="nc" id="L924">        printSlots(tempSlots);</span>
<span class="nc" id="L925">        printYellow(&quot;Production Area advanced slots:\n\n&quot;);</span>
<span class="nc" id="L926">        tempSlots.clear();</span>
<span class="nc" id="L927">        tempSlots.add(productionArea.getAdvancedSlot());</span>
<span class="nc" id="L928">        printSlots(tempSlots);</span>
<span class="nc" id="L929">    }</span>

    /**
     * Presents to the player the state of the HarvestArea
     */
    private void showHarvestArea() {
<span class="nc" id="L935">        printYellow(&quot;Harvest Area single slot:&quot;);</span>
<span class="nc" id="L936">        List&lt;ActionSlot&gt; tempSlots = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L937">        tempSlots.add(harvestArea.getSingleSlot());</span>
<span class="nc" id="L938">        printSlots(tempSlots);</span>
<span class="nc" id="L939">        printYellow(&quot;Harvest Area advanced slots:\n\n&quot;);</span>
<span class="nc" id="L940">        tempSlots.clear();</span>
<span class="nc" id="L941">        tempSlots.add(harvestArea.getAdvancedSlot());</span>
<span class="nc" id="L942">        printSlots(tempSlots);</span>
<span class="nc" id="L943">    }</span>

    /**
     * Whenever a CLI method needs to get a valid Integer within a certain range from the player,
     * this utility is invoked
     * @param availableList, list of elements of the game a player can choose among
     * @return the selected option
     */
    private Integer checkInput(List&lt;?&gt; availableList) {
<span class="nc" id="L952">        Boolean validUserInput = false;</span>
<span class="nc" id="L953">        Integer input = 0;</span>
        do {
            try {
<span class="nc" id="L956">                input = Integer.parseInt(readUserInput.nextLine());</span>
<span class="nc" id="L957">                Validator.checkValidity(--input, availableList);</span>
<span class="nc" id="L958">                validUserInput = true;</span>
            }
<span class="nc" id="L960">            catch (IncorrectInputException | InputMismatchException | NumberFormatException e) {</span>
<span class="nc" id="L961">                LOGGER.log(Level.FINEST, e.getMessage(), e);</span>
<span class="nc" id="L962">                printError(INCORRECT_INPUT);</span>
<span class="nc" id="L963">            }</span>
<span class="nc bnc" id="L964" title="All 2 branches missed.">        } while(!validUserInput);</span>

<span class="nc" id="L966">        return input;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>